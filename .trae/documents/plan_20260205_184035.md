# Implement Product Discounts

## 1. Database Schema Updates
- Create migration `20260205000000_add_product_discounts.sql`
- Add `discount_percentage` (numeric) and `discount_expires_at` (timestamptz) to `products` table
- Add `discount_percentage` (numeric) to `order_items` table to persist applied discounts

## 2. Type Definitions & Utilities
- Update `Product` interface in `src/types/product.ts`
- Create `calculateFinalPrice` helper in `src/lib/utils.ts` to centralize price logic (handling percentage and expiration)

## 3. Admin Interface (`AdminProducts.tsx`)
- Add "Discount (%)" input field
- Add "Discount Expiration" date picker
- Display "Final Price" preview (read-only)
- Update form state and submission logic

## 4. Storefront & Cart Logic
- **Cart Context (`CartContext.tsx`)**: Update `getTotal` to use `calculateFinalPrice` so the cart total reflects discounts
- **Product Card (`ProductCard.tsx`)**:
  - Display original price with strikethrough
  - Display discounted price prominently
  - Show "Offer ends in..." badge/tooltip on hover/click
- **Order Service (`orderService.ts`)**:
  - Update `createOrder` to calculate correct `unit_price` using the discount logic
  - Persist the `discount_percentage` in `order_items`

## 5. Verification
- Verify admin can set discounts
- Verify product card shows correct prices
- Verify cart total is correct
- Verify order is saved with correct prices and discount info in database